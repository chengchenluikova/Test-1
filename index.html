<!DOCTYPE html>
<html>
<head>
  <title>Leaflet Map with Export</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="Style.css" />
</head>
<body>
  <div id="sidebar">
    <h2>Map Interface</h2>
    <div id="tabs">
      <div class="tab active" onclick="showTab('poi')">Points of Interest</div>
    </div>
    <div id="tab-content">
      <div id="poi" class="tab-content">
        <ul id="marker-list"></ul>
        <button class="export-btn" onclick="exportGeoJSON()">Export as GeoJSON</button>
        <button class="export-btn" onclick="exportCSV()">Export as CSV</button>
      </div>
    </div>
  </div>

  <button id="toggle-btn" onclick="toggleSidebar()">â˜°</button>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([48.8566, 2.3522], 13); // Paris
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const markers = [];

    map.on('click', function(e) {
      const latlng = e.latlng;
      const formHtml = `
        <div class="popup-form">
          <input type="text" id="marker-title" placeholder="Name" />
          <textarea id="marker-desc" placeholder="Description"></textarea>
          <button onclick="saveMarker(${latlng.lat}, ${latlng.lng})">Add Marker</button>
        </div>
      `;
      L.popup().setLatLng(latlng).setContent(formHtml).openOn(map);
    });

    function saveMarker(lat, lng) {
      const title = document.getElementById('marker-title').value;
      const desc = document.getElementById('marker-desc').value;
      const marker = L.marker([lat, lng]).addTo(map);
      marker.bindPopup(`<strong>${title}</strong><br>${desc}`).openPopup();
      markers.push({ title, desc, lat, lng });
      updateMarkerList();
      map.closePopup();
    }

    function updateMarkerList() {
      const list = document.getElementById('marker-list');
      list.innerHTML = '';
      markers.forEach((m) => {
        const item = document.createElement('li');
        item.innerHTML = `<strong>${m.title}</strong><br>${m.desc}`;
        list.appendChild(item);
      });
    }

    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('collapsed');
    }

    function showTab(tabId) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
      document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
      document.getElementById(tabId).style.display = 'block';
    }

    function exportGeoJSON() {
      const geojson = {
        type: "FeatureCollection",
        features: markers.map(m => ({
          type: "Feature",
          geometry: {
            type: "Point",
            coordinates: [m.lng, m.lat]
          },
          properties: {
            name: m.title,
            description: m.desc
          }
        }))
      };
      downloadFile(JSON.stringify(geojson, null, 2), "markers.geojson", "application/json");
    }

    function exportCSV() {
      const header = "Name,Description,Latitude,Longitude\n";
      const rows = markers.map(m => `"${m.title}","${m.desc}",${m.lat},${m.lng}`).join("\n");
      downloadFile(header + rows, "markers.csv", "text/csv");
    }

    function downloadFile(content, filename, mime) {
      const blob = new Blob([content], { type: mime });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    showTab('poi');
  </script>
</body>
</html>
